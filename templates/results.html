{% extends "base.html" %}

{% block content %}
<h2>å¥–çŠ¶ç”³è¯·ç»“æœ</h2>

<div style="background: #e3f2fd; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
    <h4>ğŸ“Š æ—¥å¿—åˆ†ææŠ¥å‘Š</h4>
    <p><strong>æ€»è®°å½•æ•°:</strong> {{ records_count }} æ¡é€šè”è®°å½•</p>
    {% if own_call %}<p><strong>ä¸»ä½“å‘¼å·:</strong> {{ own_call }}</p>{% endif %}
    {% for award_code, result in results.items() %}
        {% if result.enhanced_records_count > 0 %}
            {% if award_code == 'WAPC' %}
                <p><strong>{{ result.award }}:</strong> è¯†åˆ«åˆ° {{ result.enhanced_records_count }} æ¡è®°å½•çš„çœä»½ä¿¡æ¯</p>
            {% elif award_code == 'WACZ' %}
                <p><strong>{{ result.award }}:</strong> è¯†åˆ«åˆ° {{ result.enhanced_records_count }} æ¡ä¸­å›½å¤§é™†ï¼ˆDXCC 318ï¼‰çš„è®°å½•</p>
            {% elif award_code == 'DXCC' %}
                <p><strong>{{ result.award }}:</strong> è¯†åˆ«åˆ° {{ result.enhanced_records_count }} ä¸ªä¸åŒçš„DXCCå®ä½“</p>
            {% else %}
                <p><strong>{{ result.award }}:</strong> é€šè¿‡å‘¼å·è‡ªåŠ¨è¯†åˆ«äº† {{ result.enhanced_records_count }} æ¡è®°å½•çš„ä¿¡æ¯</p>
            {% endif %}
        {% endif %}
    {% endfor %}
</div>

{% for award_code, result in results.items() %}
<div class="award-card {% if result.eligible %}eligible{% else %}not-eligible{% endif %}">
    <h3>{{ result.award }}</h3>
    
    {% if award_code == 'WAPC' %}
        <!-- WAPCè¯¦ç»†ä¿¡æ¯ -->
        {% for condition in result.conditions %}
            {% if 'connected_states' in condition and 'missing_states' in condition %}
                <div style="margin: 10px 0; background: #f8f9fa; padding: 15px; border-radius: 5px; border-left: 4px solid #007bff;">
                    <h4>ğŸ“‹ WAPCè¯¦ç»†ä¿¡æ¯</h4>
                    
                    <div style="margin: 10px 0;">
                        <h5>å·²é€šè”çœä»½ ({{ condition.connected_states|length }}/{{ condition.target }}):</h5>
                        <div style="display: flex; flex-wrap: wrap; gap: 5px;">
                            {% for state in condition.connected_states %}
                                <span style="background: #d4edda; color: #155724; padding: 2px 8px; border-radius: 3px; font-size: 14px;">
                                    {{ province_map.get(state, state) }}
                                </span>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <div style="margin: 10px 0;">
                        <h5>æœªé€šè”çœä»½ ({{ condition.missing_states|length }}):</h5>
                        <div style="display: flex; flex-wrap: wrap; gap: 5px;">
                            {% for state in condition.missing_states %}
                                <span style="background: #f8d7da; color: #721c24; padding: 2px 8px; border-radius: 3px; font-size: 14px;">
                                    {{ province_map.get(state, state) }}
                                </span>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            {% endif %}
        {% endfor %}
    {% elif award_code == 'WACZ' %}
        <!-- WACZè¯¦ç»†ä¿¡æ¯ -->
        {% for condition in result.conditions %}
            {% if 'connected_zones' in condition and 'missing_zones' in condition %}
                <div style="margin: 10px 0; background: #f8f9fa; padding: 15px; border-radius: 5px; border-left: 4px solid #007bff;">
                    <h4>ğŸ“‹ ä¸­å›½å¤§é™†0-9åŒºé€šè”è¯¦ç»†ä¿¡æ¯</h4>
                    
                    <div style="margin: 10px 0;">
                        <h5>å·²é€šè”åˆ†åŒº ({{ condition.connected_zones|length }}/{{ condition.target }}):</h5>
                        <div style="display: flex; flex-wrap: wrap; gap: 5px;">
                            {% for zone in condition.connected_zones %}
                                <span style="background: #d4edda; color: #155724; padding: 2px 8px; border-radius: 3px; font-size: 14px;">
                                    B{{ zone }}åŒº
                                </span>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <div style="margin: 10px 0;">
                        <h5>æœªé€šè”åˆ†åŒº ({{ condition.missing_zones|length }}):</h5>
                        <div style="display: flex; flex-wrap: wrap; gap: 5px;">
                            {% for zone in condition.missing_zones %}
                                <span style="background: #f8d7da; color: #721c24; padding: 2px 8px; border-radius: 3px; font-size: 14px;">
                                    B{{ zone }}åŒº
                                </span>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            {% endif %}
        {% endfor %}
    {% endif %}
    
    {% for condition in result.conditions %}
    <div style="margin: 10px 0;">
        <p>{{ condition.message }}</p>
        <progress value="{{ condition.current }}" max="{{ condition.target }}"></progress>
        <span>{{ condition.current }}/{{ condition.target }}</span>
    </div>
    {% endfor %}
    
    <p><strong>çŠ¶æ€:</strong> 
        {% if result.eligible %}
        <span style="color: green;">âœ“ ç¬¦åˆç”³è¯·æ¡ä»¶</span>
        {% else %}
        <span style="color: red;">âœ— æš‚ä¸ç¬¦åˆæ¡ä»¶</span>
        {% endif %}
    </p>
    
    {% if result.eligible %}
    <div style="margin-top: 10px;">
        {% if award_code == 'DXCC' %}
            <!-- DXCCå¥–çŠ¶æ”¯æŒå¤šé˜¶æ®µé€‰æ‹© -->
            <form action="/get_award" method="post" style="display: inline;">
                <select name="award_code" style="padding: 8px; margin-right: 10px;">
                    {% for condition in result.conditions %}
                        {% if 'met_targets' in condition %}
                            {% for target in condition.met_targets %}
                                <option value="{{ award_code }}{{ target }}">DXCC{{ target }}å¥–çŠ¶</option>
                            {% endfor %}
                        {% endif %}
                    {% endfor %}
                </select>
                <button type="submit" class="btn" style="background: #007bff;">è·å–é€‰æ‹©çš„å¥–çŠ¶</button>
            </form>
        {% else %}
            <!-- å…¶ä»–å¥–çŠ¶ -->
            <form action="/get_award" method="post" style="display: inline;">
                <input type="hidden" name="award_code" value="{{ award_code }}">
                <button type="submit" class="btn" style="background: #007bff;">è·å–{{ result.award }}</button>
            </form>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endfor %}

<!-- é€‰æ‹©æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„å¥–çŠ¶ -->
<div style="margin-top: 20px; text-align: center; background: #f8f9fa; padding: 15px; border-radius: 5px;">
    <h4>æ‰¹é‡ç”³è¯·å¥–çŠ¶</h4>
    <form action="/get_award" method="post">
        <div style="margin-bottom: 15px;">
            <select name="award_code" style="padding: 8px; width: 300px;">
                <option value="">-- é€‰æ‹©å•ä¸ªå¥–çŠ¶ --</option>
                <!-- æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„å¥–çŠ¶ -->
                {% for award_code, result in results.items() %}
                    {% if result.eligible %}
                        {% if award_code == 'DXCC' %}
                            {% for condition in result.conditions %}
                                {% if 'met_targets' in condition %}
                                    {% for target in condition.met_targets %}
                                        <option value="{{ award_code }}{{ target }}">{{ result.award }} ({{ target }}ä¸ªå®ä½“)</option>
                                    {% endfor %}
                                {% else %}
                                    <option value="{{ award_code }}">{{ result.award }}</option>
                                {% endif %}
                            {% endfor %}
                        {% else %}
                            <option value="{{ award_code }}">{{ result.award }}</option>
                        {% endif %}
                    {% endif %}
                {% endfor %}
                <option value="all">-- é€‰æ‹©æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„å¥–çŠ¶ --</option>
            </select>
        </div>
        <button type="submit" class="btn" style="background: #28a745; margin-right: 10px;">è·å–é€‰æ‹©çš„å¥–çŠ¶</button>
        <button type="reset" class="btn" style="background: #6c757d;">é‡ç½®</button>
    </form>
</div>

<div style="margin-top: 20px; text-align: center;">
    <a href="/upload" class="btn" style="background: #28a745;">é‡æ–°ä¸Šä¼ æ–‡ä»¶</a>
    <a href="/results" class="btn" style="background: #007bff; margin-left: 10px;">æŸ¥çœ‹ç»“æœ</a>
    <a href="/" class="btn" style="background: #6c757d; margin-left: 10px;">è¿”å›é¦–é¡µ</a>
</div>
{% endblock %}