{% extends "base.html" %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/design.css') }}">
{% endblock %}

{% block content %}
<h2>奖状设计工具</h2>
<p>使用此工具设计奖状模板，支持拖拽元素、自定义样式。</p>

<div id="design-container">
    <!-- 左侧：设计画布 -->
    <div id="award-canvas">
        <!-- 奖状元素将通过JavaScript动态添加到这里 -->
    </div>
    
    <!-- 右侧：控制面板 -->
    <div id="control-panel">
        <!-- 背景设置 -->
        <div class="control-group">
            <h3>背景设置</h3>
            <label>背景颜色：</label>
            <input type="color" id="background-color" value="#ffffff">
            <br>
            <label>画布预览底图（仅预览）：</label>
            <input type="file" id="background-upload" accept="image/*">
            <br>
            <label>模板底图（将随模板保存到奖状文件夹）：</label>
            <input type="file" id="template-background" accept="image/*">
            <button id="template-background-clear" type="button" style="margin-left:8px;">清除</button>
            <div style="font-size:12px;color:#666;margin-top:6px;">提示："画布预览底图" 仅用于本地预览；"模板底图" 会在点击保存时上传并写入模板目录。</div>
            <br>
            <label>模板 Logo（将随模板保存）：</label>
            <input type="file" id="template-logo" accept="image/*">
            <button id="template-logo-clear" type="button" style="margin-left:8px;">清除</button>
            <div style="font-size:12px;color:#666;margin-top:6px;">提示：Logo 可保存为模板资源，也可在画布上添加“奖状标志”元素并为该元素上传图片来调整位置大小。</div>
        </div>
        
        <!-- 添加元素 -->
        <div class="control-group">
            <h3>添加元素</h3>
            <div id="element-list">
                <button id="add-logo">奖状标志</button>
                <button id="add-title">奖状标题</button>
                <button id="add-description">奖状说明</button>
                <button id="add-project">奖状项目</button>
                <button id="add-recipient">领奖用户</button>
                <button id="add-award-number">奖状编号</button>
                <button id="add-date">生成日期</button>
                <button id="add-signer">签发人</button>
            </div>
        </div>
        
        <!-- 元素属性控制 -->
        <div class="control-group" id="element-controls" style="display: none;">
            <h3>元素属性</h3>
            <label>文本内容：</label>
            <input type="text" id="element-text">
            <br>
            <label>字体：</label>
            <select id="element-font">
                <option value="Arial">Arial</option>
                <option value="SimSun">宋体</option>
                <option value="Microsoft YaHei">微软雅黑</option>
                <option value="KaiTi">楷体</option>
                <option value="Times New Roman">Times New Roman</option>
            </select>
            <br>
            <label>字号：</label>
            <input type="number" id="element-size" min="8" max="72" value="16">
            <br>
            <label>颜色：</label>
            <input type="color" id="element-color" value="#000000">
            <br>
            <label style="display: inline-block;"><input type="checkbox" id="element-bold"> 粗体</label>
            <label style="display: inline-block; margin-left: 10px;"><input type="checkbox" id="element-italic"> 斜体</label>
            <label style="display: inline-block; margin-left: 10px;"><input type="checkbox" id="element-underline"> 下划线</label>
            <br>
            <div id="element-image-control" style="display:none; margin-top:8px;">
                <label>上传元素图片（仅对 logo 生效）：</label>
                <input type="file" id="element-image-upload" accept="image/*">
            </div>
            <button id="delete-element" style="width: 100%; margin-top: 10px; padding: 8px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer;">删除元素</button>
        </div>
        
        <!-- 保存和预览 -->
        <div class="control-group">
            <button id="save-template">保存模板</button>
            <button id="preview-template">预览模板</button>
        </div>
    </div>
</div>

<!-- 奖状选择弹窗（在保存模板时弹出） -->
<div id="award-select-overlay" style="display:none; position:fixed; left:0; top:0; right:0; bottom:0; background: rgba(0,0,0,0.5); z-index:1000;">
    <div style="width:400px; margin:100px auto; background:white; padding:20px; border-radius:6px;">
        <h3>选择奖状模板</h3>
        <label>搜索：</label>
        <input type="text" id="award-search" style="width:100%; padding:6px; margin-bottom:8px;">
        <label>从下列奖状列表选择：</label>
        <select id="award-select" style="width:100%; height:120px;" size="6">
            <option value="">-- 请选择奖状代码 --</option>
            {% for a in awards %}
                <option value="{{ a['code'] }}">{{ a['code'] }} - {{ a['name'] }}</option>
            {% endfor %}
        </select>
        <div style="margin-top:12px; display:flex; gap:8px;">
            <button id="award-select-confirm" style="flex:1;">确定并保存</button>
            <button id="award-select-cancel" style="flex:1;">取消</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/design.js') }}"></script>
{% endblock %}